<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>
<?php

$_shipment=$this->getShipment();
$_order=$this->getOrder();
$tracking_links_base = array(
    'usps' => 'https://tools.usps.com/go/TrackConfirmAction.action?tLabels=',
    'ups' => 'https://wwwapps.ups.com/WebTracking/track?track=yes&trackNums=',
);
?>
<?php if ($_shipment && $_order && $_shipment->getAllTracks()): ?>
<table cellspacing="0" cellpadding="0" border="0" width="650" style="border:1px solid #EAEAEA;">
    <thead>
        <tr>
            <th align="left" bgcolor="#EAEAEA" style="font-size:13px; padding:3px 9px"><?php echo $this->__('Shipped By') ?></th>
            <th align="center" bgcolor="#EAEAEA" style="font-size:13px; padding:3px 9px"><?php echo $this->__('Tracking Number') ?></th>
        </tr>
    </thead>
    <tbody>
    <?php $i=0; foreach ($_shipment->getAllTracks() as $_item): $i++ ?>
        <?php
        $carrier_code = $_item->getCarrierCode();
        $base_link = $tracking_links_base[$carrier_code];
        $tracking_number = strip_tags($_item->getNumber());
        if (array_key_exists($carrier_code, $tracking_links_base) && isset($tracking_number) && strlen($tracking_number) > 6) {
            $tracking_display = '<a title="Track your Package" alt="Track your Package" href="' . $tracking_links_base[$carrier_code] . $tracking_number . '">' . $tracking_number . '</a>';
        } else {
            if (isset($tracking_number) && strlen($tracking_number) > 6) $tracking_display = $tracking_number;
            else $tracking_display = '';
        }
        ?>
        <tr <?php echo $i%2?'bgcolor="#F6F6F6"':'' ?>>
            <td align="left" valign="top" style="padding:3px 9px"><?php echo $_item->getTitle(); ?></td>
            <td align="center" valign="top" style="padding:3px 9px"><?php echo $tracking_display; ?></td>
        </tr>
    <?php endforeach ?>
    </tbody>
</table>
<?php endif; ?>
