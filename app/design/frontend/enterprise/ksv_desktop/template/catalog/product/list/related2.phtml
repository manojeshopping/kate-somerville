<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2010 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>

<?php if($this->getItems()->getSize()): ?>
<div class="box-collateral box-related products-grid">

    <div class="box-title">
        <h3><?php echo $this->__('Our Skin Health Experts also suggest') ?></h3>
    </div>
   
    <?php $counter = 0; $limit = 6; $i=0; foreach($this->getItems() as $_item): 
	?>
    <?php if ($i++%3==0): ?>
    <ul class="block-content products-grid">
    <?php endif ?>
    
    	<?php if ($counter<$limit): ?>
        <li class="item<?php if(($i-1)%3==0): ?> first<?php elseif($i%3==0): ?> last<?php endif; ?>">
		<div class="product-bottom">
        	<a href="<?php echo $_item->getProductUrl() ?>" class="product-image" id="<?= $_item->getEntityId() ?>"><img src="<?php echo $this->helper('catalog/image')->init($_item, 'small_image')->resize(100) ?>" width="100" height="100" alt="<?php echo $this->htmlEscape($_item->getName()) ?>" title="<?php echo $this->htmlEscape($_item->getName()) ?>" /></a>
	        <div class="no-display">
	            <input type="hidden" name="product" value="<?php echo $_item->getId() ?>" />
	        </div>
        			
            <div class="product-details">
            	<a href="<?php echo $_item->getProductUrl() ?>" title="<?php echo $this->stripTags($_item->getData('title'), null, true) ?>"><?php echo $_item->getData('title'); ?><br /><?php echo $_item->getData('sub_title'); ?></a>
            </div>
		</div>
        </li>
        <?php $counter++; ?>
        <?php endif; ?>
        
    <?php if ($i%3==0 || $i==$this->getItems()->count() ): ?>
    </ul>
    <?php endif ?>
    <?php endforeach ?>
    <script type="text/javascript">decorateGeneric($$('.box-related ul.block-content'), ['odd','even','first','last'])</script>

    <script type="text/javascript">
    //<![CDATA[
    $$('.related-checkbox').each(function(elem){
        Event.observe(elem, 'click', addRelatedToProduct)
    });
    
    var relatedProductsCheckFlag = false;
    function selectAllRelated(txt){
        if (relatedProductsCheckFlag == false) {
            $$('.related-checkbox').each(function(elem){
                elem.checked = true;
            });
            relatedProductsCheckFlag = true;
            txt.innerHTML="<strong><?php echo $this->__('unselect all') ?><\/strong>";
        } else {
            $$('.related-checkbox').each(function(elem){
                elem.checked = false;
            });
            relatedProductsCheckFlag = false;
            txt.innerHTML="<strong><?php echo $this->__('select all') ?><\/strong>";
        }
        addRelatedToProduct();
    }
    
    function addRelatedToProduct(){
        var checkboxes = $$('.related-checkbox');
        var values = [];
        for(var i=0;i<checkboxes.length;i++){
            if(checkboxes[i].checked) values.push(checkboxes[i].value);
        }
        if($('related-products-field')){
            $('related-products-field').value = values.join(',');
        }
    }
    //]]>
    </script>
    
</div>
<?php endif ?>
